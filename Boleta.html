<!DOCTYPE html>
<html lang="es">
<head>
    <title>Fit Express - Boleta Electr√≥nica</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        :root {
            --fit-green: #28a745;
            --fit-dark: #1e1e28;
            --fit-card: #2d2d39;
            --fit-border: #444455;
            --text-light: #f8f9fa;
        }

        body {
            background-color: var(--fit-dark) !important;
            color: var(--text-light);
        }

        .main-card {
            max-width: 450px;
            width: 95%;
            padding: 30px;
            border-radius: 10px;
            background-color: var(--fit-card) !important;
            color: var(--text-light) !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            border: 1px solid var(--fit-border);
        }

        .divider {
            border: none;
            border-top: 1px solid var(--fit-border);
            margin: 15px 0;
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1em;
            color: var(--text-light);
        }

        .data-label {
            font-weight: bold;
            color: #adb5bd;
            flex-basis: 40%;
        }

        .data-value {
            text-align: right;
            flex-basis: 60%;
        }

        #boleta-detalles {
            background-color: #383845 !important;
            color: var(--text-light) !important;
            border: 1px solid var(--fit-border) !important;
            padding: 10px;
            font-size: 0.9rem;
            line-height: 1.5;
            resize: none;
            width: 100%;
            min-height: 150px;
            border-radius: 5px;
        }

        .total-row {
            font-size: 1.4em;
            font-weight: bold;
            color: var(--fit-green);
        }
    </style>
</head>
<body class="d-flex align-items-center justify-content-center vh-100">

    <div class="main-card">

        <h3 class="text-center mb-2 text-light">Boleta Electr√≥nica Fit Express</h3>
        <p class="text-center text-secondary mb-4">¬°Tu pedido saludable en camino! üèÉ</p>
        <hr class="divider">

        <div class="data-row">
            <span class="data-label">ID de Pedido:</span>
            <span class="data-value fw-bold text-warning" id="boleta-id">#Cargando...</span>
        </div>

        <div class="data-row">
            <span class="data-label">Fecha de emisi√≥n:</span>
            <span class="data-value" id="boleta-fecha">Cargando...</span>
        </div>

        <div class="data-row">
            <span class="data-label">Email Cliente:</span>
            <span class="data-value" id="boleta-email">cliente@correo.com</span>
        </div>

        <hr class="divider">

        <p class="fw-bold mb-2 text-warning">Detalles del Bowl:</p>

        <pre id="boleta-detalles">Cargando detalles...</pre>

        <hr class="divider">

        <div class="data-row">
            <span class="data-label">Medio de pago:</span>
            <span class="data-value" id="boleta-medio-pago">Cargando...</span>
        </div>

        <div class="data-row total-row mt-3">
            <span class="data-label">TOTAL PAGADO:</span>
            <span class="data-value" id="boleta-total">$0</span>
        </div>

        <hr class="divider">

        <p class="text-center mt-3" style="font-size:0.9em;">¬°Gracias por preferir Fit Express!</p>
        <a class="btn btn-success w-100 mt-3" href="index.html">
            Volver al Men√∫ Principal
        </a>

    </div>

    <script>
        const formatCurrency = (number) => {
            return '$' + Math.round(number).toLocaleString('es-CL');
        };

        function getOrderById(orderId) {
            const history = JSON.parse(localStorage.getItem('orderHistory')) || [];
            return history.find(order => order.id === orderId);
        }

        function loadBoletaDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('orderId');

            if (!orderId) {
                document.getElementById('boleta-id').textContent = 'Error: ID no encontrado';
                return;
            }

            const order = getOrderById(orderId);

            if (!order) {
                document.getElementById('boleta-id').textContent = `#${orderId} - Pedido no encontrado.`;
                return;
            }

            let detallesTexto = "";
            let contador = 1;

            Object.keys(order.products).forEach((productId) => {
                const item = order.products[productId];
                const itemSubtotal = item.quantity * item.price;
                detallesTexto += `${contador}. ${item.name} (x${item.quantity}) - ${formatCurrency(itemSubtotal)}\n`;
                contador++;
            });

            detallesTexto += `\nSubtotal de √≠tems: ${formatCurrency(order.total)}`;

            document.getElementById('boleta-id').textContent = `#${order.id}`;
            document.getElementById('boleta-fecha').textContent = order.date;
            document.getElementById('boleta-email').textContent = localStorage.getItem('userEmail') || 'Invitado'; // Usar email del login si existe
            document.getElementById('boleta-medio-pago').textContent = order.paymentMethod;
            document.getElementById('boleta-detalles').textContent = detallesTexto.trim();
            document.getElementById('boleta-total').textContent = formatCurrency(order.total);
        }

        window.onload = loadBoletaDetails;
    </script>
</body>
</html>
