<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carrito de Compras - Fit Express</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css"> 
  </head>

<body>
  <div class="container">
    <h1 class="text-center mb-4">üõí Tu Carrito Fit Express</h1>

    <div class="row text-center text-secondary fw-bold border-bottom pb-2 mb-3 mx-0">
        <div class="col-6 text-start">PRODUCTO</div>
        <div class="col-2">CANTIDAD</div>
        <div class="col-2">SUBTOTAL</div>
        <div class="col-2">ELIMINAR</div>
    </div>
    
    <div id="cart-container"></div> 

    <div class="text-center mt-4">
      <a href="index.html" class="btn btn-secondary me-2">‚¨Ö Volver al Men√∫</a>
      <button class="btn btn-danger me-2" onclick="vaciarYRenderizar()">Vaciar Carrito üóëÔ∏è</button>
      <button id="checkout-btn" class="btn btn-success">Ir al Pago üí≥</button>
    </div>

    <div id="cart-totals" class="p-3 mt-4 text-end mx-auto" style="max-width: 400px;">
      </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/main.js"></script> 
  
  <script>
    // üí∞ Formatear moneda (√önica funci√≥n aqu√≠ que no est√° en main.js)
    function formatCurrency(number) {
      return '$' + Math.round(number).toLocaleString('es-CL');
    }

    // üîÑ Renderizar productos en el carrito
    function renderCart() {
      const cart = getShoppingCart(); 
      const container = document.getElementById('cart-container');
      const totalsContainer = document.getElementById('cart-totals');
      container.innerHTML = '';
      totalsContainer.innerHTML = '';

      const productIds = Object.keys(cart);
      if (productIds.length === 0) {
        container.innerHTML = `
          <div class="empty-cart card p-5">
            <h3>Tu carrito est√° vac√≠o </h3>
            <p>Agrega bowls deliciosos desde el inicio </p>
          </div>
        `;
        return;
      }

      let total = 0;
      productIds.forEach(id => {
        const item = cart[id];
        const subtotal = item.price * item.quantity;
        total += subtotal;

        // üî• NUEVA ESTRUCTURA TIPO TABLA/FILA üî•
        const productHTML = `
          <div class="cart-item-row row align-items-center mx-0" id="item-${id}">
            
            <div class="col-6 d-flex align-items-center">
                <img src="${item.image}" class="cart-img me-3" alt="${item.name}">
                <div>
                    <h5 class="mb-0">${item.name}</h5>
                    <p class="mb-0 text-secondary">${formatCurrency(item.price)} c/u</p>
                </div>
            </div>

            <div class="col-2 quantity-control d-flex align-items-center justify-content-center">
                <button class="btn btn-sm" onclick="updateQuantityAndRender('${id}', -1)">‚àí</button>
                <span class="mx-2">${item.quantity}</span>
                <button class="btn btn-sm" onclick="updateQuantityAndRender('${id}', 1)">+</button>
            </div>

            <div class="col-2 text-end fw-bold">
                ${formatCurrency(subtotal)}
            </div>
            
            <div class="col-2 text-center">
                <button class="btn btn-sm btn-danger" onclick="removeItemAndRender('${id}')">‚ùå</button>
            </div>
          </div>
        `;
        container.insertAdjacentHTML('beforeend', productHTML);
      });

      // Renderiza los totales finales
      totalsContainer.innerHTML = `
        <div class="row mb-2">
            <div class="col-6 text-start">Subtotal:</div>
            <div class="col-6 fw-bold">${formatCurrency(total)}</div>
        </div>
        <div class="row mb-3 border-bottom pb-3">
            <div class="col-6 text-start">Env√≠o:</div>
            <div class="col-6 text-warning">Gratis (Santiago)</div>
        </div>
        <div class="row">
            <div class="col-6 text-start h4">TOTAL:</div>
            <div class="col-6 h4 fw-bold text-success">${formatCurrency(total)}</div>
        </div>
      `;
    }
    
    // --- Funciones de Control que llaman a renderCart ---
    
    function updateQuantityAndRender(id, change) {
        // Usa la l√≥gica de main.js para cambiar la cantidad
        const cart = getShoppingCart();
        if (cart[id]) {
            cart[id].quantity += change;
            if (cart[id].quantity <= 0) {
                delete cart[id];
            }
            saveShoppingCart(cart);
        }
        renderCart(); // Vuelve a dibujar el carrito
        updateCartCount(); // Actualiza el contador de la navbar
    }

    function removeItemAndRender(id) {
        removeFromCart(id); // Usa la funci√≥n de main.js
        renderCart(); 
        updateCartCount(); 
    }
    
    function vaciarYRenderizar() {
        vaciarCarrito(); // Usa la funci√≥n de main.js
        renderCart();
        updateCartCount(); 
    }

    // üí≥ Ir al pago
    document.getElementById('checkout-btn').addEventListener('click', () => {
      const cart = getShoppingCart();
      if (Object.keys(cart).length === 0) {
        alert('Tu carrito est√° vac√≠o ');
        return;
      }
      alert('¬°Dirigiendo a la p√°gina de pago!');
      // window.location.href = 'Pago.html'; 
    });

    // Inicializar
    document.addEventListener('DOMContentLoaded', () => {
        renderCart();
        updateCartCount(); // Asegura que el contador de la navbar est√© correcto al entrar
    });
  </script>
</body>
</html>
